<!-- patient-profile-setup.component.html -->
<div class="profile-setup-bg">
  <div class="profile-setup-container">
    <!-- Header -->
    <div class="setup-header">
      <div class="header-content">
        <h1>Complete Your Profile</h1>
        <p>Help us provide you with the best healthcare experience by completing your profile.</p>

        <!-- Progress Bar -->
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="(currentStep / totalSteps) * 100"></div>
          </div>
          <div class="progress-steps">
            <div class="step"
                 *ngFor="let step of [1,2,3,4]; let i = index"
                 [class.active]="currentStep === step"
                 [class.completed]="currentStep > step"
                 (click)="goToStep(step)">
              <span class="step-number">{{step}}</span>
              <span class="step-label">
                {{step === 1 ? 'Personal' : step === 2 ? 'Medical' : step === 3 ? 'Emergency' : 'Insurance'}}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Content -->
    <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="profile-form">

      <!-- Step 1: Personal Information -->
      <div class="form-step" *ngIf="currentStep === 1">
        <div class="step-header">
          <h2>Personal Information</h2>
          <p>Basic information to help us identify you and contact you when needed.</p>
        </div>

        <div formGroupName="personalInfo" class="form-content">
          <!-- Profile Picture -->
<!--          <div class="profile-picture-section">-->
<!--            <div class="picture-upload">-->
<!--              <div class="picture-preview" *ngIf="profilePicturePreview; else noPicture">-->
<!--                <img [src]="profilePicturePreview" alt="Profile Preview">-->
<!--                <button type="button" class="remove-picture-btn" (click)="removeProfilePicture()">-->
<!--                  <i class="fas fa-times"></i>-->
<!--                </button>-->
<!--              </div>-->
<!--              <ng-template #noPicture>-->
<!--                <div class="picture-placeholder">-->
<!--                  <i class="fas fa-user"></i>-->
<!--                </div>-->
<!--              </ng-template>-->
<!--              <input type="file" id="profilePicture" accept="image/*"-->
<!--                     (change)="onProfilePictureSelected($event)" style="display: none;">-->
<!--              <label for="profilePicture" class="upload-btn">-->
<!--                <i class="fas fa-camera"></i>-->
<!--                {{profilePicturePreview ? 'Change Photo' : 'Add Photo'}}-->
<!--              </label>-->
<!--            </div>-->
<!--          </div>-->

          <!-- Name Fields -->
          <div class="form-row">
            <div class="form-group">
              <label for="firstName">First Name <span class="required">*</span></label>
              <input type="text" id="firstName" formControlName="firstName"
                     class="form-control" placeholder="Enter your first name">
              <div class="error-message"
                   *ngIf="profileForm.get('personalInfo.firstName')?.invalid && profileForm.get('personalInfo.firstName')?.touched">
                First name is required (minimum 2 characters)
              </div>
            </div>

            <div class="form-group">
              <label for="lastName">Last Name <span class="required">*</span></label>
              <input type="text" id="lastName" formControlName="lastName"
                     class="form-control" placeholder="Enter your last name">
              <div class="error-message"
                   *ngIf="profileForm.get('personalInfo.lastName')?.invalid && profileForm.get('personalInfo.lastName')?.touched">
                Last name is required (minimum 2 characters)
              </div>
            </div>
          </div>

          <!-- Personal Details -->
          <div class="form-row">
            <div class="form-group">
              <label for="dateOfBirth">Date of Birth <span class="required">*</span></label>
              <input type="date" id="dateOfBirth" formControlName="dateOfBirth"
                     class="form-control" [max]="maxDate">
              <div class="info-text" *ngIf="calculateAge()">
                Age: {{calculateAge()}} years old
              </div>
            </div>

            <div class="form-group">
              <label for="gender">Gender <span class="required">*</span></label>
              <select id="gender" formControlName="gender" class="form-control">
                <option value="">Select Gender</option>
                <option *ngFor="let gender of genders" [value]="gender">{{gender}}</option>
              </select>
            </div>
          </div>

          <!-- ID and Contact -->
          <div class="form-row">
            <div class="form-group">
              <label for="idNumber">South African ID Number <span class="required">*</span></label>
              <input type="text" id="idNumber" formControlName="idNumber"
                     class="form-control" placeholder="13-digit ID number"
                     maxlength="13" pattern="[0-9]{13}">
              <div class="error-message"
                   *ngIf="profileForm.get('personalInfo.idNumber')?.invalid && profileForm.get('personalInfo.idNumber')?.touched">
                Please enter a valid 13-digit SA ID number
              </div>
            </div>

            <div class="form-group">
              <label for="phoneNumber">Phone Number <span class="required">*</span></label>
              <input type="tel" id="phoneNumber" formControlName="phoneNumber"
                     class="form-control" placeholder="e.g., 0823456789">
              <div class="error-message"
                   *ngIf="profileForm.get('personalInfo.phoneNumber')?.invalid && profileForm.get('personalInfo.phoneNumber')?.touched">
                Please enter a valid South African phone number
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="alternatePhoneNumber">Alternate Phone Number</label>
              <input type="tel" id="alternatePhoneNumber" formControlName="alternatePhoneNumber"
                     class="form-control" placeholder="Optional backup number">
            </div>

            <div class="form-group">
              <label for="preferredLanguage">Preferred Language</label>
              <select id="preferredLanguage" formControlName="preferredLanguage" class="form-control">
                <option value="English">English</option>
                <option value="Afrikaans">Afrikaans</option>
                <option value="Zulu">Zulu</option>
                <option value="Xhosa">Xhosa</option>
                <option value="Sotho">Sotho</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>

          <!-- Address Section -->
          <div class="address-section" formGroupName="address">
            <h3>Address Information</h3>

            <div class="form-row">
              <div class="form-group full-width">
                <label for="street">Street Address <span class="required">*</span></label>
                <input type="text" id="street" formControlName="street"
                       class="form-control" placeholder="Street number and name">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="suburb">Suburb <span class="required">*</span></label>
                <input type="text" id="suburb" formControlName="suburb"
                       class="form-control" placeholder="Suburb or area">
              </div>

              <div class="form-group">
                <label for="city">City <span class="required">*</span></label>
                <input type="text" id="city" formControlName="city"
                       class="form-control" placeholder="City">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="province">Province <span class="required">*</span></label>
                <select id="province" formControlName="province" class="form-control">
                  <option value="">Select Province</option>
                  <option *ngFor="let province of provinces" [value]="province">{{province}}</option>
                </select>
              </div>

              <div class="form-group">
                <label for="postalCode">Postal Code <span class="required">*</span></label>
                <input type="text" id="postalCode" formControlName="postalCode"
                       class="form-control" placeholder="4-digit postal code"
                       maxlength="4" pattern="[0-9]{4}">
              </div>
            </div>
          </div>

          <!-- Additional Personal Info -->
          <div class="additional-info">
            <h3>Additional Information (Optional)</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="occupation">Occupation</label>
                <input type="text" id="occupation" formControlName="occupation"
                       class="form-control" placeholder="Your job title">
              </div>

              <div class="form-group">
                <label for="employer">Employer</label>
                <input type="text" id="employer" formControlName="employer"
                       class="form-control" placeholder="Company name">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="maritalStatus">Marital Status</label>
                <select id="maritalStatus" formControlName="maritalStatus" class="form-control">
                  <option value="">Select Status</option>
                  <option value="Single">Single</option>
                  <option value="Married">Married</option>
                  <option value="Divorced">Divorced</option>
                  <option value="Widowed">Widowed</option>
                  <option value="Separated">Separated</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 2: Medical Information -->
      <div class="form-step" *ngIf="currentStep === 2">
        <div class="step-header">
          <h2>Medical Information</h2>
          <p>Help us understand your health better. All information is confidential.</p>
        </div>

        <div formGroupName="medicalHistory" class="form-content">
          <!-- Basic Medical Info -->
          <div class="medical-basics">
            <div class="form-row">
              <div class="form-group">
                <label for="bloodType">Blood Type</label>
                <select id="bloodType" formControlName="bloodType" class="form-control">
                  <option value="">Select Blood Type</option>
                  <option *ngFor="let type of bloodTypes" [value]="type">{{type}}</option>
                </select>
              </div>

              <div class="form-group">
                <label for="height">Height (cm)</label>
                <input type="number" id="height" formControlName="height"
                       class="form-control" placeholder="e.g., 170" min="50" max="300">
              </div>

              <div class="form-group">
                <label for="weight">Weight (kg)</label>
                <input type="number" id="weight" formControlName="weight"
                       class="form-control" placeholder="e.g., 70" min="20" max="500">
                <div class="info-text" *ngIf="calculateBMI()">
                  BMI: {{calculateBMI()}}
                  <span [class]="calculateBMI()! < 18.5 ? 'underweight' : calculateBMI()! > 25 ? 'overweight' : 'normal'">
                    ({{calculateBMI()! < 18.5 ? 'Underweight' : calculateBMI()! > 25 ? 'Overweight' : 'Normal'}})
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- Allergies Section -->
          <div class="medical-section">
            <div class="section-header">
              <h3>Allergies</h3>
              <button type="button" class="add-btn" (click)="addAllergy()">
                <i class="fas fa-plus"></i> Add Allergy
              </button>
            </div>

            <div formArrayName="allergies" class="medical-items">
              <div *ngIf="allergies.length === 0" class="no-items">
                No allergies added. Click "Add Allergy" to add one.
              </div>

              <div *ngFor="let allergy of allergies.controls; let i = index"
                   [formGroupName]="i" class="medical-item">
                <div class="item-header">
                  <h4>Allergy {{i + 1}}</h4>
                  <button type="button" class="remove-btn" (click)="removeAllergy(i)">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label>Allergy Name</label>
                    <input type="text" formControlName="name" class="form-control"
                           placeholder="e.g., Peanuts, Penicillin">
                  </div>
                  <div class="form-group">
                    <label>Severity</label>
                    <select formControlName="severity" class="form-control">
                      <option value="">Select Severity</option>
                      <option value="Mild">Mild</option>
                      <option value="Moderate">Moderate</option>
                      <option value="Severe">Severe</option>
                      <option value="Life-threatening">Life-threatening</option>
                    </select>
                  </div>
                </div>

                <div class="form-group">
                  <label>Description/Symptoms</label>
                  <textarea formControlName="description" class="form-control"
                            placeholder="Describe the allergic reaction"></textarea>
                </div>
              </div>
            </div>
          </div>

          <!-- Chronic Conditions Section -->
          <div class="medical-section">
            <div class="section-header">
              <h3>Chronic Conditions</h3>
              <button type="button" class="add-btn" (click)="addChronicCondition()">
                <i class="fas fa-plus"></i> Add Condition
              </button>
            </div>

            <div formArrayName="chronicConditions" class="medical-items">
              <div *ngIf="chronicConditions.length === 0" class="no-items">
                No chronic conditions added.
              </div>

              <div *ngFor="let condition of chronicConditions.controls; let i = index"
                   [formGroupName]="i" class="medical-item">
                <div class="item-header">
                  <h4>Condition {{i + 1}}</h4>
                  <button type="button" class="remove-btn" (click)="removeChronicCondition(i)">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label>Condition Name</label>
                    <input type="text" formControlName="name" class="form-control"
                           placeholder="e.g., Diabetes, Hypertension">
                  </div>
                  <div class="form-group">
                    <label>Diagnosed Date</label>
                    <input type="date" formControlName="startDate" class="form-control">
                  </div>
                </div>

                <div class="form-group">
                  <label>Notes</label>
                  <textarea formControlName="notes" class="form-control"
                            placeholder="Additional information about this condition"></textarea>
                </div>
              </div>
            </div>
          </div>

          <!-- Current Medications Section -->
          <div class="medical-section">
            <div class="section-header">
              <h3>Current Medications</h3>
              <button type="button" class="add-btn" (click)="addMedication()">
                <i class="fas fa-plus"></i> Add Medication
              </button>
            </div>

            <div formArrayName="currentMedications" class="medical-items">
              <div *ngIf="currentMedications.length === 0" class="no-items">
                No current medications added.
              </div>

              <div *ngFor="let medication of currentMedications.controls; let i = index"
                   [formGroupName]="i" class="medical-item">
                <div class="item-header">
                  <h4>Medication {{i + 1}}</h4>
                  <button type="button" class="remove-btn" (click)="removeMedication(i)">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label>Medication Name</label>
                    <input type="text" formControlName="name" class="form-control"
                           placeholder="e.g., Metformin, Lisinopril">
                  </div>
                  <div class="form-group">
                    <label>Dosage</label>
                    <input type="text" formControlName="description" class="form-control"
                           placeholder="e.g., 500mg twice daily">
                  </div>
                </div>

                <div class="form-group">
                  <label>Purpose/Notes</label>
                  <textarea formControlName="notes" class="form-control"
                            placeholder="What is this medication for?"></textarea>
                </div>
              </div>
            </div>
          </div>

          <!-- Previous Surgeries Section -->
          <div class="medical-section">
            <div class="section-header">
              <h3>Previous Surgeries</h3>
              <button type="button" class="add-btn" (click)="addSurgery()">
                <i class="fas fa-plus"></i> Add Surgery
              </button>
            </div>

            <div formArrayName="previousSurgeries" class="medical-items">
              <div *ngIf="previousSurgeries.length === 0" class="no-items">
                No previous surgeries added.
              </div>

              <div *ngFor="let surgery of previousSurgeries.controls; let i = index"
                   [formGroupName]="i" class="medical-item">
                <div class="item-header">
                  <h4>Surgery {{i + 1}}</h4>
                  <button type="button" class="remove-btn" (click)="removeSurgery(i)">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label>Surgery Type</label>
                    <input type="text" formControlName="name" class="form-control"
                           placeholder="e.g., Appendectomy, Knee Surgery">
                  </div>
                  <div class="form-group">
                    <label>Date</label>
                    <input type="date" formControlName="startDate" class="form-control">
                  </div>
                </div>

                <div class="form-group">
                  <label>Notes</label>
                  <textarea formControlName="notes" class="form-control"
                            placeholder="Additional details about the surgery"></textarea>
                </div>
              </div>
            </div>
          </div>

          <!-- Lifestyle Information -->
          <div class="lifestyle-section">
            <h3>Lifestyle Information</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="smokingStatus">Smoking Status</label>
                <select id="smokingStatus" formControlName="smokingStatus" class="form-control">
                  <option value="">Select Status</option>
                  <option value="Never">Never Smoked</option>
                  <option value="Former">Former Smoker</option>
                  <option value="Current">Current Smoker</option>
                  <option value="Occasional">Occasional Smoker</option>
                </select>
              </div>

              <div class="form-group">
                <label for="alcoholConsumption">Alcohol Consumption</label>
                <select id="alcoholConsumption" formControlName="alcoholConsumption" class="form-control">
                  <option value="">Select Frequency</option>
                  <option value="Never">Never</option>
                  <option value="Rarely">Rarely</option>
                  <option value="Occasionally">Occasionally</option>
                  <option value="Regularly">Regularly</option>
                  <option value="Daily">Daily</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="exerciseFrequency">Exercise Frequency</label>
                <select id="exerciseFrequency" formControlName="exerciseFrequency" class="form-control">
                  <option value="">Select Frequency</option>
                  <option value="Never">Never</option>
                  <option value="Rarely">Rarely</option>
                  <option value="1-2 times per week">1-2 times per week</option>
                  <option value="3-4 times per week">3-4 times per week</option>
                  <option value="5+ times per week">5+ times per week</option>
                  <option value="Daily">Daily</option>
                </select>
              </div>

              <div class="form-group">
                <label for="dietaryRestrictions">Dietary Restrictions</label>
                <input type="text" id="dietaryRestrictions" formControlName="dietaryRestrictions"
                       class="form-control" placeholder="e.g., Vegetarian, Halal, Gluten-free">
              </div>
            </div>

            <div class="form-group">
              <label for="familyMedicalHistory">Family Medical History</label>
              <textarea id="familyMedicalHistory" formControlName="familyMedicalHistory"
                        class="form-control" rows="3"
                        placeholder="Any significant medical conditions in your family (heart disease, diabetes, cancer, etc.)"></textarea>
            </div>
          </div>

          <!-- Vaccination Status -->
          <div class="vaccination-section" formGroupName="vaccinationStatus">
            <h3>Vaccination Status</h3>
            <p class="section-description">Please indicate your vaccination status for the following:</p>

            <div class="vaccination-grid">
              <div class="vaccination-item">
                <label class="checkbox-label">
                  <input type="checkbox" formControlName="covid19">
                  <span class="checkmark"></span>
                  COVID-19 Vaccination
                </label>
              </div>

              <div class="vaccination-item">
                <label class="checkbox-label">
                  <input type="checkbox" formControlName="flu">
                  <span class="checkmark"></span>
                  Annual Flu Shot
                </label>
              </div>

              <div class="vaccination-item">
                <label class="checkbox-label">
                  <input type="checkbox" formControlName="hepatitisB">
                  <span class="checkmark"></span>
                  Hepatitis B
                </label>
              </div>

              <div class="vaccination-item">
                <label class="checkbox-label">
                  <input type="checkbox" formControlName="tetanus">
                  <span class="checkmark"></span>
                  Tetanus
                </label>
              </div>
            </div>

            <div class="form-group">
              <label for="otherVaccinations">Other Vaccinations</label>
              <input type="text" id="otherVaccinations" formControlName="other"
                     class="form-control" placeholder="List any other vaccinations">
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3: Emergency Contacts -->
      <div class="form-step" *ngIf="currentStep === 3">
        <div class="step-header">
          <h2>Emergency Contacts</h2>
          <p>Provide details of people we can contact in case of an emergency.</p>
        </div>

        <div formArrayName="emergencyContacts" class="form-content">
          <div *ngFor="let contact of emergencyContactsArray.controls; let i = index"
               [formGroupName]="i" class="emergency-contact-card">
            <div class="contact-header">
              <h3>Emergency Contact {{i + 1}}</h3>
              <button type="button" class="remove-contact-btn"
                      (click)="removeEmergencyContact(i)"
                      *ngIf="emergencyContactsArray.length > 1">
                <i class="fas fa-trash"></i>
              </button>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Full Name <span class="required">*</span></label>
                <input type="text" formControlName="name" class="form-control"
                       placeholder="Contact's full name">
                <div class="error-message"
                     *ngIf="contact.get('name')?.invalid && contact.get('name')?.touched">
                  Name is required
                </div>
              </div>

              <div class="form-group">
                <label>Relationship <span class="required">*</span></label>
                <select formControlName="relationship" class="form-control">
                  <option value="">Select Relationship</option>
                  <option *ngFor="let rel of relationshipTypes" [value]="rel">{{rel}}</option>
                </select>
                <div class="error-message"
                     *ngIf="contact.get('relationship')?.invalid && contact.get('relationship')?.touched">
                  Relationship is required
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Primary Phone <span class="required">*</span></label>
                <input type="tel" formControlName="phoneNumber" class="form-control"
                       placeholder="Primary contact number">
                <div class="error-message"
                     *ngIf="contact.get('phoneNumber')?.invalid && contact.get('phoneNumber')?.touched">
                  Valid phone number is required
                </div>
              </div>

              <div class="form-group">
                <label>Alternate Phone</label>
                <input type="tel" formControlName="alternatePhoneNumber" class="form-control"
                       placeholder="Optional backup number">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Email Address</label>
                <input type="email" formControlName="email" class="form-control"
                       placeholder="Contact's email address">
              </div>

              <div class="form-group">
                <label>Address</label>
                <input type="text" formControlName="address" class="form-control"
                       placeholder="Contact's address">
              </div>
            </div>

            <div class="contact-permissions">
              <div class="permission-item">
                <label class="checkbox-label">
                  <input type="checkbox" formControlName="isPrimary">
                  <span class="checkmark"></span>
                  Primary Emergency Contact
                </label>
              </div>

              <div class="permission-item">
                <label class="checkbox-label">
                  <input type="checkbox" formControlName="canMakeDecisions">
                  <span class="checkmark"></span>
                  Can Make Medical Decisions
                </label>
              </div>
            </div>
          </div>

          <button type="button" class="add-contact-btn" (click)="addEmergencyContact()">
            <i class="fas fa-plus"></i>
            Add Another Emergency Contact
          </button>
        </div>
      </div>

      <!-- Step 4: Insurance Information -->
      <div class="form-step" *ngIf="currentStep === 4">
        <div class="step-header">
          <h2>Insurance Information</h2>
          <p>Help us process your claims faster by providing your insurance details.</p>
        </div>

        <div formGroupName="insuranceInfo" class="form-content">
          <!-- Insurance Status -->
          <div class="insurance-status">
            <label class="checkbox-label large">
              <input type="checkbox" formControlName="hasInsurance">
              <span class="checkmark"></span>
              I have medical insurance/medical aid
            </label>
          </div>

          <!-- Primary Insurance -->
          <div class="insurance-section"
               *ngIf="profileForm.get('insuranceInfo.hasInsurance')?.value"
               formGroupName="primaryInsurance">
            <h3>Primary Insurance Details</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="provider">Insurance Provider <span class="required">*</span></label>
                <select id="provider" formControlName="provider" class="form-control">
                  <option value="">Select Provider</option>
                  <option value="Discovery Health">Discovery Health</option>
                  <option value="Momentum Health">Momentum Health</option>
                  <option value="Medihelp">Medihelp</option>
                  <option value="Bonitas">Bonitas</option>
                  <option value="Gems">GEMS</option>
                  <option value="Fedhealth">Fedhealth</option>
                  <option value="Other">Other</option>
                </select>
              </div>

              <div class="form-group">
                <label for="policyNumber">Policy/Member Number <span class="required">*</span></label>
                <input type="text" id="policyNumber" formControlName="policyNumber"
                       class="form-control" placeholder="Your member number">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="planName">Plan Name</label>
                <input type="text" id="planName" formControlName="planName"
                       class="form-control" placeholder="e.g., Executive Plan, Hospital Plan">
              </div>

              <div class="form-group">
                <label for="groupNumber">Group Number</label>
                <input type="text" id="groupNumber" formControlName="groupNumber"
                       class="form-control" placeholder="If applicable">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="effectiveDate">Effective Date</label>
                <input type="date" id="effectiveDate" formControlName="effectiveDate"
                       class="form-control">
              </div>

              <div class="form-group">
                <label for="expirationDate">Expiration Date</label>
                <input type="date" id="expirationDate" formControlName="expirationDate"
                       class="form-control">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="copayAmount">Copay Amount (R)</label>
                <input type="number" id="copayAmount" formControlName="copayAmount"
                       class="form-control" placeholder="e.g., 200" min="0">
              </div>

              <div class="form-group">
                <label for="deductibleAmount">Annual Deductible (R)</label>
                <input type="number" id="deductibleAmount" formControlName="deductibleAmount"
                       class="form-control" placeholder="e.g., 5000" min="0">
              </div>
            </div>
          </div>

          <!-- Secondary Insurance -->
          <div class="secondary-insurance"
               *ngIf="profileForm.get('insuranceInfo.hasInsurance')?.value && profileForm.get('insuranceInfo.secondaryInsurance') as secondaryInsuranceGroup">
            <div formGroupName="secondaryInsurance">
              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" formControlName="hasSecondary">
                  <span class="checkmark"></span>
                  I have secondary insurance coverage
                </label>
              </div>

              <div class="insurance-section"
                   *ngIf="secondaryInsuranceGroup.get('hasSecondary')?.value">
                <h3>Secondary Insurance Details</h3>

                <div class="form-row">
                  <div class="form-group">
                    <label>Insurance Provider <span class="required">*</span></label>
                    <input type="text" formControlName="provider" class="form-control"
                           placeholder="Secondary insurance provider">
                  </div>

                  <div class="form-group">
                    <label>Policy Number <span class="required">*</span></label>
                    <input type="text" formControlName="policyNumber" class="form-control"
                           placeholder="Secondary policy number">
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Medical Aid Specific Fields -->
          <div class="medical-aid-section"
               *ngIf="profileForm.get('insuranceInfo.hasInsurance')?.value">
            <h3>Medical Aid Information</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="medicalAidNumber">Medical Aid Number</label>
                <input type="text" id="medicalAidNumber" formControlName="medicalAidNumber"
                       class="form-control" placeholder="Your medical aid number">
              </div>

              <div class="form-group">
                <label for="dependentCode">Dependent Code</label>
                <input type="text" id="dependentCode" formControlName="dependentCode"
                       class="form-control" placeholder="If you're a dependent">
              </div>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="authorizationRequired">
                <span class="checkmark"></span>
                Pre-authorization required for specialist visits
              </label>
            </div>
          </div>

          <!-- No Insurance Option -->
          <div class="no-insurance-info"
               *ngIf="!profileForm.get('insuranceInfo.hasInsurance')?.value">
            <div class="info-card">
              <i class="fas fa-info-circle"></i>
              <div class="info-content">
                <h4>No Insurance Coverage</h4>
                <p>You've indicated that you don't have medical insurance. You can still receive quality healthcare services. Payment options will be discussed during your appointments.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Navigation Buttons -->
      <div class="form-navigation">
        <div class="nav-buttons">
          <button type="button" class="btn btn-secondary"
                  (click)="prevStep()"
                  *ngIf="currentStep > 1"
                  [disabled]="isSubmitting">
            <i class="fas fa-chevron-left"></i>
            Previous
          </button>

          <div class="nav-center">
            <button type="button" class="btn btn-outline"
                    (click)="saveDraft()"
                    [disabled]="isSubmitting">
              <i class="fas fa-save"></i>
              Save Draft
            </button>

            <button type="button" class="btn btn-outline"
                    (click)="skipStep()"
                    *ngIf="currentStep === 2 || currentStep === 4"
                    [disabled]="isSubmitting">
              Skip Step
            </button>
          </div>

          <button type="button" class="btn btn-primary"
                  (click)="nextStep()"
                  *ngIf="currentStep < totalSteps"
                  [disabled]="!isStepValid(currentStep) || isSubmitting">
            Next
            <i class="fas fa-chevron-right"></i>
          </button>

          <button type="submit" class="btn btn-success"
                  *ngIf="currentStep === totalSteps"
                  [disabled]="!profileForm.valid || isSubmitting">
            <i class="fas fa-check" *ngIf="!isSubmitting"></i>
            <i class="fas fa-spinner fa-spin" *ngIf="isSubmitting"></i>
            {{isSubmitting ? 'Saving...' : 'Complete Profile'}}
          </button>
        </div>
      </div>
    </form>
  </div>


<button class="btn btn-secondary left-logout-btn" (click)="logout()">
  Logout
</button>

</div>
